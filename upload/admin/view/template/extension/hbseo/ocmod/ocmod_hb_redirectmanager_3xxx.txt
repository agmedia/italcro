<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>SEO - Broken Link Redirect Manager [3xxx]</name>
    <version>{huntbee_version}</version>
    <author>HuntBee OpenCart Services</author>
    <link>https://www.huntbee.com</link>
	<code>broken_link_manager_ocmod</code>

	<file path="catalog/controller/error/not_found.php">		
		 <operation>
                <search><![CDATA[$this->response->addHeader($this->request->server['SERVER_PROTOCOL'] . ' 404 Not Found');]]> </search>
                <add position="before"><![CDATA[
				$this->load->model('extension/module/brokenlink_manager');
				$this->model_extension_module_brokenlink_manager->checkandredirect();]]></add>
            </operation>
			
			 <operation>
                <search><![CDATA[$data['continue']]]></search>
                <add position="before"><![CDATA[
				$language_id = $this->config->get('config_language_id');
				
				if ($this->config->get('hb_brokenlinks_enablepage')) {
				    $data['custom_page'] = $this->config->get('hb_brokenlinks_page'.$language_id);
				    $data['custom_page'] = html_entity_decode($data['custom_page']);
				}else{
				    $data['custom_page'] = false;
				}
				
				]]>
                </add>
            </operation>			
        </file>	
		
		<file path="catalog/controller/product/{product,category,manufacturer}.php">		
		 <operation error="skip">
                <search><![CDATA[$this->response->addHeader($this->request->server['SERVER_PROTOCOL']]]> </search>
                <add position="before"><![CDATA[
				$this->load->model('extension/module/brokenlink_manager');
				$this->model_extension_module_brokenlink_manager->checkandredirect();]]></add>
            </operation>
			
        </file>	
		
		<file path="catalog/controller/information/information.php">		
		 <operation error="skip">
                <search><![CDATA[$this->response->addHeader($this->request->server['SERVER_PROTOCOL']]]> </search>
                <add position="before"><![CDATA[
				$this->load->model('extension/module/brokenlink_manager');
				$this->model_extension_module_brokenlink_manager->checkandredirect();]]></add>
            </operation>
			
        </file>		
		
		
		<file path="catalog/view/theme/*/template/error/not_found.twig">
            <operation>
                <search><![CDATA[{{ text_error }}]]></search>
                <add position="replace"><![CDATA[{% if (custom_page is defined) %} {{ custom_page }} {% else %} {{ text_error }} {% endif %}]]>
                </add>
            </operation>
        </file>
		
		<file path="catalog/controller/common/header.php">
            <operation>
                <search><![CDATA[$data['title'] = $this->document->getTitle();]]></search>
                <add position="before"><![CDATA[
                $this->load->model('extension/module/brokenlink_manager');
                $this->model_extension_module_brokenlink_manager->validateCommonRedirect();
				]]>
                </add>
            </operation>
        </file>		
</modification>