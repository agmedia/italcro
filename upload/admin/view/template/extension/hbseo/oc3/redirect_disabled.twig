{{ header }}{{ column_left }} 
<!--Main Content block start-->

<div id="content">
  <!--Header Start-->
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
		<a href="{{ doc_link }}" target="_blank" class="btn btn-default"><i class="fa fa-book"></i>&nbsp;{{ button_doc }}</a>
		<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
	  </div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %} 
        <li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
        {% endfor %} 
      </ul>
    </div>
  </div>
  <!--Header End-->
  <!--Container 1 start -->
  <div class="container-fluid">
    <!--Start - Error / Success Message if any -->
    {% if (error_warning) %} 
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }} 
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %} 
    {% if (success) %} 
    <div class="alert alert-success"><i class="fa fa-check-circle"></i> {{ success }} 
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %} 
    <!--End - Error / Success Message if any -->
	<div id="msgoutput"></div>
	
    <!--Panel Content Start-->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-refresh"></i> {{ heading_title }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-rd" class="form-horizontal">
			<!--Tabs UL Starts-->
			<ul class="nav nav-tabs" id="tabs">
                <li class="active"><a href="#tab-products" onclick="loadBlock('products');" data-toggle="tab"><i class="fa fa-bars" aria-hidden="true"></i>&nbsp;{{ tab_products }}</a></li>
				<li><a href="#tab-categories" onclick="loadBlock('categories');" data-toggle="tab"><i class="fa fa-bars" aria-hidden="true"></i>&nbsp;{{ tab_categories }}</a></li>
				<li><a href="#tab-informations" onclick="loadBlock('informations');" data-toggle="tab"><i class="fa fa-bars" aria-hidden="true"></i>&nbsp;{{ tab_informations }}</a></li>
	          </ul>
			  <!--Tabs UL Ends-->
			  <div class="tab-content">

			  	<div class="tab-pane active" id="tab-products">
					<div class="row" style="margin-bottom:10px;">
						<div class="col-sm-12">
							<div class="input-group">
								<input type="text" id="search-products-value" onkeyup="searchRecord('products');" class="form-control" placeholder="{{ text_search_product }}">
								<span class="input-group-addon btn" id="search-products-button" onclick="searchRecord('products');"><i class="fa fa-search"></i></span>
							</div>
						</div>
					</div>

					<div id="products-block" class="ajax-block"></div>
				</div>
				
				<div class="tab-pane" id="tab-categories">
					<div class="row" style="margin-bottom:10px;">
						<div class="col-sm-12">
							<div class="input-group">
								<input type="text" id="search-categories-value" onkeyup="searchRecord('categories');" class="form-control" placeholder="{{ text_search_category }}">
								<span class="input-group-addon btn" id="search-categories-button" onclick="searchRecord('categories');"><i class="fa fa-search"></i></span>
							</div>
						</div>
					</div>

					<div id="categories-block" class="ajax-block"></div>
				</div>

				<div class="tab-pane" id="tab-informations">
					<div class="row" style="margin-bottom:10px;">
						<div class="col-sm-12">
							<div class="input-group">
								<input type="text" id="search-informations-value" onkeyup="searchRecord('informations');" class="form-control" placeholder="{{ text_search_information }}">
								<span class="input-group-addon btn" id="search-informations-button" onclick="searchRecord('informations');"><i class="fa fa-search"></i></span>
							</div>
						</div>
					</div>

					<div id="informations-block" class="ajax-block"></div>
				</div>				
			  </div><!--tab-content block end-->
        </form>

		<!--MODAL START-->
		<div class="modal fade" id="hits-modal" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>	  
				<h4 class="modal-title"><b><span id="hits-modal-header"></span></b></h4>  
				</div>
				<div class="modal-body">
					<div id="hits-modal-block"></div>
				</div>
			</div>
			</div>
		</div>
		<!--MODAL END-->
		
      </div>
    </div>
    <!--Panel Content End-->
    <!--Huntbee copyrights-->
    <div class="container-fluid">
      <center>
        <span class="help">{{ heading_title }} - {{ extension_version }} &copy; <a href="https://www.huntbee.com/">WWW.HUNTBEE.COM</a> | <a href="https://www.huntbee.com/get-support">SUPPORT</a></span>
      </center>
    </div>
    <!--Huntbee copyrights end-->
  </div>
  <!--Container 1 start -->
</div>
<!--Main Content block end-->
<style type="text/css"> <!--addtional css-->
a {cursor:pointer;}
</style>

<style type="text/css">
.loaddiv{margin:100px;color:#0099CC;}
body{font-family: sans-serif; }
</style>

<script type="text/javascript">
$(document).ready(function() {
	loadBlock('products');
});
</script>
<script type="text/javascript">
$('#products-block').delegate('.pagination a', 'click', function(e) {
	e.preventDefault();
	$('#products-block').load(this.href);
});

$('#categories-block').delegate('.pagination a', 'click', function(e) {
	e.preventDefault();
	$('#categories-block').load(this.href);
});

$('#informations-block').delegate('.pagination a', 'click', function(e) {
	e.preventDefault();
	$('#informations-block').load(this.href);
});


function loadBlock(name){
	$('.ajax-block').html('');
	$('#'+name+'-block').html('<center><div class="loaddiv"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i></div></center>');
	$('#'+name+'-block').load('index.php?route={{ base_route }}/redirect_disabled/'+name+'&user_token={{ user_token }}&store_id={{ store_id }}');
}

function searchRecord(item) {
	var search_value = $('#search-'+item+'-value').val();
	$('#'+item+'-block').fadeOut().load('index.php?route={{ base_route }}/redirect_disabled/'+item+'&user_token={{ user_token }}&search='+encodeURIComponent(search_value)).fadeIn('slow');
}
</script>

<script type="text/javascript">
function hitsModal(type, item_id, name) {
	$('#hits-modal-header').html(name);
	$('#hits-modal-block').html('<center><div class="loaddiv"><i class="fa fa-circle-o-notch fa-spin fa-3x fa-fw"></i></div></center>');
	$('#hits-modal-block').load('index.php?route={{ base_route }}/redirect_disabled/logs&user_token={{ user_token }}&type='+type+'&item_id='+item_id);
	$('#hits-form-result').html('');
	$('#hits-modal').modal('show');
}

function editRow(type, item_id){
	$('.editable-cell').html('');

	$('.cellvalue').show();
	$('.row-editbutton').show();
	$('.row-savebutton').hide();

	$('#pagetypevalue'+item_id).hide();
	$('#redirectvalue'+item_id).hide();
	$('#redirecttypevalue'+item_id).hide();
	$('#row-editbutton'+item_id).hide();
	$('#row-savebutton'+item_id).show();

	$('#cell-pagetype-'+item_id).html('<select class="form-control" id="pagetype'+item_id+'" onchange="redirectCellForm(this.value, '+item_id+');"><option value="product">Product</option><option value="category">Category</option><option value="information">Information</option><option value="custom">Custom</option></select>');
	redirectCellForm('product', item_id);
	$('#cell-redirect-type-'+item_id).html('<select class="form-control" id="redirecttype'+item_id+'"><option value="302">302 Moved Temporarily</option><option value="301">301 Moved Permanently</option></select>');
}

function redirectCellForm(pagetype, id){
	$('#cell-redirect-'+id).load('index.php?route={{ base_route }}/redirect_disabled/link_selector_form&user_token={{ user_token }}&pagetype='+pagetype);
}	

function saveRow(type, item_id){
	$('#msgoutput').html('');
	const pagetype = $('#pagetype'+item_id).val();
	const redirect_product_id = $('#redirect_product_id').val();
	const redirect_category_id = $('#redirect_category_id').val();
	const redirect_information_id = $('#redirect_information_id').val();
	const redirect_custom = $('#redirect_custom').val();
	const redirect_type = $('#redirecttype'+item_id).val();

	let redirect_label = '';
    switch (pagetype) {
        case 'product':
            redirect_label = $('#redirect_product_lookup').val();
            break;
        case 'category':
            redirect_label = $('#redirect_category_lookup').val();
            break;
        case 'information':
            redirect_label = $('#redirect_information_lookup').val();
            break;
        case 'custom':
            redirect_label = redirect_custom;
            break;
    }

	const data = {
		type,
        item_id,
        pagetype,
        redirect_type,
        redirect_product_id,
        redirect_category_id,
        redirect_information_id,
        redirect_custom
    };
	
	$.ajax({
		type: 'post',
		url: 'index.php?route={{ base_route }}/redirect_disabled/save_redirect&user_token={{ user_token }}',
		data,
		dataType: 'json',
		success: function(json) {
			if (json['success']) {
				$('#msgoutput').html('<div class="alert alert-success"><i class="fa fa-check-circle"></i> '+json['success']+'<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
				$('#pagetypevalue'+item_id).html(pagetype);
				$('#redirectvalue'+item_id).html(redirect_label);
				$('#redirecttypevalue'+item_id).html(redirect_type);
				$('#row-savebutton'+item_id).hide();
				$('#row-editbutton'+item_id).show();

				$('.editable-cell').html('');
				$('.cellvalue').show();
			}
			if (json['error']) {
				$('#msgoutput').html('<div class="alert alert-danger">'+json['error']+'<button type="button" class="close" data-dismiss="alert">&times;</button></div>');
			}
		},			
		error: function(xhr, ajaxOptions, thrownError) {
			alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
		}
	 });	
}
</script>
{{ footer }}